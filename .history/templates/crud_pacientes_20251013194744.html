{% extends 'crud_base.html' %}

{% block crud_content %}
<header class="crud-header">
  <div>
    <div class="crud-title">üë• Gesti√≥n de Pacientes</div>
    <div class="crud-subtitle">Administrar pacientes del sistema</div>
  </div>
  <div class="crud-actions">
    <button class="btn btn-primary" onclick="showCreateForm()">+ Nuevo Paciente</button>
    <a href="/api/pacientes/" class="btn btn-secondary" target="_blank">API</a>
  </div>
</header>

<div id="createForm" class="crud-card" style="display:none;">
  <h3>Registrar Nuevo Paciente</h3>
  <form method="POST" action="{% url 'api:paciente-list' %}">
    {% csrf_token %}
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
      <div class="form-group">
        <label class="form-label">RUT</label>
        <input type="text" class="form-input" name="rut" placeholder="11.111.111-1" required>
      </div>
      <div class="form-group">
        <label class="form-label">Fecha Nacimiento</label>
        <input type="date" class="form-input" name="fecha_nacimiento" required>
      </div>
      <div class="form-group">
        <label class="form-label">Nombre</label>
        <input type="text" class="form-input" name="nombre" placeholder="Nombre" required>
      </div>
      <div class="form-group">
        <label class="form-label">Apellido</label>
        <input type="text" class="form-input" name="apellido" placeholder="Apellido" required>
      </div>
      <div class="form-group">
        <label class="form-label">G√©nero</label>
        <select class="form-input" name="genero" required>
          <option value="">Seleccionar</option>
          <option value="Masculino">Masculino</option>
          <option value="Femenino">Femenino</option>
          <option value="Otro">Otro</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Tipo de Sangre</label>
        <select class="form-input" name="tipo_sangre" required>
          <option value="">Seleccionar</option>
          <option value="A+">A+</option>
          <option value="O+">O+</option>
          <option value="B+">B+</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Tel√©fono</label>
        <input type="text" class="form-input" name="telefono" placeholder="+56 9 1234 5678">
      </div>
      <div class="form-group">
        <label class="form-label">Correo</label>
        <input type="email" class="form-input" name="correo" placeholder="correo@ejemplo.com">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Direcci√≥n</label>
      <input type="text" class="form-input" name="direccion" placeholder="Direcci√≥n completa">
    </div>
    <div class="action-buttons" style="margin-top: 20px;">
      <button type="submit" class="btn btn-primary">Guardar</button>
      <button type="button" class="btn btn-secondary" onclick="hideCreateForm()">Cancelar</button>
    </div>
  </form>
</div>

<div class="crud-card">
  <h3>Pacientes Registrados</h3>
  <table class="table">
    <thead>
      <tr>
        <th>RUT</th>
        <th>Nombre Completo</th>
        <th>G√©nero</th>
        <th>Tipo de Sangre</th>
        <th>Tel√©fono</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      {% for paciente in pacientes %}
      <tr>
        <td>{{ paciente.rut }}</td>
        <td>{{ paciente.nombre }} {{ paciente.apellido }}</td>
        <td>{{ paciente.genero }}</td>
        <td>{{ paciente.tipo_sangre }}</td>
        <td>{{ paciente.telefono }}</td>
        <td class="action-buttons">
          <button class="btn btn-edit btn-small">Editar</button>
          <button class="btn btn-delete btn-small">Eliminar</button>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" style="text-align: center; color: var(--muted);">
          No hay pacientes registrados
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
function showCreateForm() { 
  document.getElementById('createForm').style.display = 'block'; 
}
function hideCreateForm() { 
  document.getElementById('createForm').style.display = 'none'; 
}
</script>
{% endblock %}